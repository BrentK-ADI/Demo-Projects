<!DOCTYPE html>
<html>
    <head>
        <title>Summary of Results</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Optimization by Example</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Summary of Results
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">

                    <div id="main-content" class="wiki-content group">
                    <p>At this point, several iterations of both the AWB and Bayer algorithms have been completed with great results. At each iteration, a different approach was taken to improve performance, ranging from small changes such as combining loop operations, up to complex modifications such as including SIMD assembly instructions.</p><p>The follow table summarize the run time against the baseline for each algorithm independently:</p><p><u><strong>Auto White Balance</strong></u></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/><col/></colgroup><tbody><tr><th style="text-align: center;" class="confluenceTh"><a href="789693435.html">Baseline</a></th><th style="text-align: center;" class="confluenceTh"><a href="789693510.html">Iteration1</a></th><th style="text-align: center;" class="confluenceTh"><a href="789693561.html">Iteration2</a></th><th style="text-align: center;" class="confluenceTh"><a href="789693626.html">Iteration3</a></th><th colspan="1" style="text-align: center;" class="confluenceTh"><a href="789693684.html">Iteration4</a></th></tr><tr><td style="text-align: center;" class="confluenceTd">27.088ms</td><td style="text-align: center;" class="confluenceTd">14.965ms (-44.8%)</td><td style="text-align: center;" class="confluenceTd">10.231ms (-62%)</td><td style="text-align: center;" class="confluenceTd">6.456ms (-76%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">4.933ms (-81.5%)</td></tr></tbody></table></div><p class="auto-cursor-target"><u><strong>Bayer</strong></u></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 63.2474%;"><colgroup><col style="width: 19.2708%;"/><col style="width: 12.3264%;"/><col style="width: 14.0625%;"/><col style="width: 13.4549%;"/><col style="width: 11.4583%;"/><col style="width: 12.066%;"/><col style="width: 17.3611%;"/></colgroup><tbody><tr><th class="confluenceTh"><br/></th><th style="text-align: center;" class="confluenceTh"><a href="796177313.html">Baseline</a></th><th style="text-align: center;" class="confluenceTh"><a href="796500111.html">Iteration5</a></th><th style="text-align: center;" class="confluenceTh"><a href="795307407.html">Iteration6</a></th><th colspan="1" style="text-align: center;" class="confluenceTh"><a href="795307751.html">Iteration7</a></th><th colspan="1" style="text-align: center;" class="confluenceTh"><a href="795307901.html">Iteration8</a></th><th colspan="1" style="text-align: center;" class="confluenceTh"><a href="795308087.html">Iteration9</a></th></tr><tr><th class="confluenceTh">Single Bayer Call</th><td style="text-align: center;" class="confluenceTd">215us</td><td style="text-align: center;" class="confluenceTd">207us (-3.7%)</td><td style="text-align: center;" class="confluenceTd">88us (-59%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">57.5us (-73.2%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">39us (-81.8%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">29us (-86.5%)</td></tr><tr><th class="confluenceTh">Single Row Bayer/CNN Load</th><td style="text-align: center;" class="confluenceTd">318us</td><td style="text-align: center;" class="confluenceTd">307us (-3.4%)</td><td style="text-align: center;" class="confluenceTd">189us (-40.5%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">163us (-48.7%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">140us (-55.9%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">116us (-63.5%)</td></tr><tr><th class="confluenceTh">Full Bayer/CNN Load</th><td style="text-align: center;" class="confluenceTd">71.750ms</td><td style="text-align: center;" class="confluenceTd">69.399ms (-3.2%)</td><td style="text-align: center;" class="confluenceTd">41.649ms (-41.9%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">35.104ms (-51%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">31.164ms (-56.5%)</td><td colspan="1" style="text-align: center;" class="confluenceTd">25.891ms (-63.9%)</td></tr></tbody></table></div><p class="auto-cursor-target">And finally, revisiting the complete execution time of a single frame from the <a href="Project-Overview_789692365.html">project overview:</a></p><p class="auto-cursor-target"><strong>Baseline: </strong>98.849ms</p><p class="auto-cursor-target"><strong>Iteration9</strong>: 30.826ms (-68.8%)</p><p class="auto-cursor-target"><u>A total of 68ms, or 68.8%. of the single frame run time was optimized out. </u></p><p class="auto-cursor-target"><span style="letter-spacing: 0.0px;">The implications of these savings are significant. </span></p><ul><li class="auto-cursor-target">For battery powered systems which look to extend system life and maximize time between charges, this could be up to 68% additional battery life.</li><li class="auto-cursor-target">For high performance systems which look to maximize data through put, the time saved in processing could support up to 3 frames of image processing in the time it previously took to do a single frame</li><li class="auto-cursor-target">For size and cost constrained systems, the time saved in pre-processing the images could be utilized to perform other system tasks, allow a smaller, or less expensive microcontroller to be designed in.</li></ul><h1 class="auto-cursor-target" id="SummaryofResults-Discussion">Discussion</h1><p>Based on the results of the Bayer testing, as the iterations increasingly improved the run time of the Bayer code itself, the overall runtime improvement began to slow down.  This can be concluded that the loading of data in the CNN is the largest consumer of system time.  Further testing concluded that of the 30.826ms frame run time, about 21ms of that time is spent checking the CNN FIFO status and loading the register.  So much like the hardware CNN accelerator itself shifted the time constraints of the inference processing on to the sensor acquisition time rather than executing the model itself, the improvements to the Bayer and AWB algorithms have shifted the time constraints from the pre-processing operations to the CNN loading operation.</p><h2 id="SummaryofResults-NextSteps">Next Steps</h2><p>In order to improve the overall performance of the system, the next logical target would be to improve the CNN load time performance.  There are several  hardware features of the CNN engine, outside the scope of this exercise, which could improve load times, such as utilizing DMA or double buffering the Bayer loops, loading the previous row data asynchronously while the next row data is being calculated.  Once the CNN load time is reduced, additional experimentation can occur.  Of particular interest is the CNN models success rate working with image data that while not esthetically pleasing for viewing by a person, may contain suitable information to match the current inference performance.  These include options such as:</p><ul><li>Eliminating the color correction</li><li>Utilizing nearest-neighbor Bayer demosaicing</li></ul><p>Additionally, further optimization of the existing algorithms may be done, such as:</p><ul><li>Performing the color correction scaling as part of the Bayer algorithm to reduce memory reads/writes</li><li>Using the 1 frame lag method for color correction, calculating the scale factors as part of the Bayer loops, and using the scale factor from the previous frame for correction</li><li>Including additional manual assembly operations to more tightly control instruction choice</li></ul><p>In both these cases, while some additional run time may be removed, the cost of complexity does not add value against the CNN load time constraint.</p>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">

            </div>
        </div>     </body>
</html>
